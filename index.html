<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Die</title>
<style>
  :root{
    /* ==== YOUR DEFAULTS ==== */
    --preset: none;              /* none | ivory */
    --chips: 1;                  /* 1=chips on, 0=off */
    --chips-density: 0.20;       /* 0â€“1 how many chips */
    --chips-contrast: 0.40;      /* 0â€“1 how dark chips look */
    --chips-size: 1;             /* scale for chip radius (1=normal) */

    --size: min(60vmin,260px);
    --bg: #0d0f12;
    --face: #acab22;             /* your yellow-green */
    --edge: #2a2e36;
    --pip:  #111111;
    --accent: #007aff;

    --roll-ms: 720ms;
    --wear: 1.0;                 /* max wear */
    --pip-wear: 0.10;            /* base pip wear opacity */
    --pip-size: 50%;             /* pip diameter (% of grid cell) */
  }
  @media (prefers-color-scheme: light){ :root{ --bg:#f7f7f9; --edge:#d0d3d8; } }

  html,body{
    height:100%; margin:0; background:var(--bg);
    font-family:-apple-system,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    display:grid; place-items:center; gap:28px; user-select:none; touch-action:manipulation;
  }
  .scene{ width:var(--size); height:var(--size); perspective:1000px; }
  .die{
    width:100%; height:100%; position:relative; transform-style:preserve-3d;
    transition:transform 500ms cubic-bezier(.22,.68,0,1.2); will-change:transform;
  }

  .face{
    position:absolute; inset:0; width:100%; height:100%;
    background: var(--face);
    background-image:
      radial-gradient(rgba(0,0,0,.035) 1px, transparent 1px),
      radial-gradient(rgba(255,255,255,.04) 1px, transparent 1px),
      linear-gradient(135deg, rgba(255,255,255,.12), rgba(0,0,0,.08));
    background-size: 3px 3px, 5px 5px, 100% 100%;
    border:2px solid var(--edge); border-radius:18px;
    box-shadow:
      inset 0 0 0 2px var(--edge),
      inset 1px 1px 6px rgba(255,255,255,.35),
      inset -2px -2px 6px rgba(0,0,0,.25),
      0 8px 16px rgba(0,0,0,.25);
    display:grid; place-items:center; backface-visibility:hidden;
    filter: contrast(1.02) brightness(0.98);
    overflow:hidden;
  }
  .grit-face{ position:absolute; inset:0; pointer-events:none; opacity:var(--wear);
              background-size:cover; mix-blend-mode:multiply; filter:blur(.2px) contrast(1.2); }
  .chips-edge{ position:absolute; inset:0; pointer-events:none; background-size:cover;
               mix-blend-mode:multiply; opacity: calc(var(--wear) * var(--chips-contrast)); }

  .grid{ width:78%; height:78%;
         display:grid; grid-template-columns:repeat(3,1fr); grid-template-rows:repeat(3,1fr) }
  .dot{
    width:var(--pip-size); height:var(--pip-size);
    border-radius:50%; background:var(--pip);
    box-shadow:
      inset 1px 1px 2px rgba(255,255,255,.12),
      inset -2px -2px 2px rgba(0,0,0,.35),
      0 1px 3px rgba(0,0,0,.6);
    place-self:center; position:relative; overflow:hidden;
  }
  /* unique per-pip wear (image + rotation set via JS) */
  .dot::after{
    content:""; position:absolute; inset:0; border-radius:50%;
    background-size:cover; background-image: var(--pipTex);
    opacity: var(--pipWearLocal, var(--pip-wear));
    mix-blend-mode:screen; filter:contrast(1.3) brightness(1.1);
    transform: rotate(var(--pipRot, 0deg));
    will-change: transform;
  }

  .pos-tl{grid-area:1/1}.pos-tc{grid-area:1/2}.pos-tr{grid-area:1/3}
  .pos-ml{grid-area:2/1}.pos-c{grid-area:2/2}.pos-mr{grid-area:2/3}
  .pos-bl{grid-area:3/1}.pos-bc{grid-area:3/2}.pos-br{grid-area:3/3}

  /* cube layout */
  .front{ transform: translateZ(calc(var(--size)/2)) }              /* 1 */
  .back{  transform: rotateY(180deg) translateZ(calc(var(--size)/2)) } /* 6 */
  .right{ transform: rotateY(90deg)  translateZ(calc(var(--size)/2)) }  /* 3 */
  .left{  transform: rotateY(-90deg) translateZ(calc(var(--size)/2)) }  /* 4 */
  .top{   transform: rotateX(90deg)  translateZ(calc(var(--size)/2)) }   /* 5 */
  .bottom{transform: rotateX(-90deg) translateZ(calc(var(--size)/2)) }   /* 2 */

  /* tumble animation on repeat */
  .rolling{ animation:wobble var(--roll-ms) cubic-bezier(.22,.68,0,1.2); }
  @keyframes wobble{
    0%   { transform: rotateX(var(--rx0)) rotateY(var(--ry0)) rotateZ(var(--rz0)); }
    45%  { transform: rotateX(var(--rx1)) rotateY(var(--ry1)) rotateZ(var(--rz1)); }
    85%  { transform: rotateX(var(--rx2)) rotateY(var(--ry2)) rotateZ(var(--rz2)); }
    100% { transform: rotateX(var(--rx3)) rotateY(var(--ry3)) rotateZ(var(--rz3)); }
  }
  @media (prefers-reduced-motion: reduce){ .rolling{animation:none} .die{transition:none} }

  button{
    padding:14px 22px; font-size:18px; font-weight:700; border:0; border-radius:12px;
    background:var(--accent); color:#fff; box-shadow:0 8px 18px rgba(0,0,0,.25);
  }
  button:active{ transform:scale(.97) }
</style>
</head>
<body>
  <div class="scene">
    <div id="die" class="die">
      <!-- 1 -->
      <div class="face front"><div class="grit-face"></div><div class="chips-edge"></div><div class="grid">
        <div class="dot pos-c"></div>
      </div></div>
      <!-- 6 -->
      <div class="face back"><div class="grit-face"></div><div class="chips-edge"></div><div class="grid">
        <div class="dot pos-tl"></div><div class="dot pos-ml"></div><div class="dot pos-bl"></div>
        <div class="dot pos-tr"></div><div class="dot pos-mr"></div><div class="dot pos-br"></div>
      </div></div>
      <!-- 3 -->
      <div class="face right"><div class="grit-face"></div><div class="chips-edge"></div><div class="grid">
        <div class="dot pos-tl"></div><div class="dot pos-c"></div><div class="dot pos-br"></div>
      </div></div>
      <!-- 4 -->
      <div class="face left"><div class="grit-face"></div><div class="chips-edge"></div><div class="grid">
        <div class="dot pos-tl"></div><div class="dot pos-tr"></div>
        <div class="dot pos-bl"></div><div class="dot pos-br"></div>
      </div></div>
      <!-- 5 -->
      <div class="face top"><div class="grit-face"></div><div class="chips-edge"></div><div class="grid">
        <div class="dot pos-tl"></div><div class="dot pos-tr"></div>
        <div class="dot pos-c"></div>
        <div class="dot pos-bl"></div><div class="dot pos-br"></div>
      </div></div>
      <!-- 2 -->
      <div class="face bottom"><div class="grit-face"></div><div class="chips-edge"></div><div class="grid">
        <div class="dot pos-tl"></div><div class="dot pos-br"></div>
      </div></div>
    </div>
  </div>

  <button id="rollBtn">ðŸŽ² Re-roll</button>

<script>
  /* Face-up orientations */
  const ORIENT = {
    1:'rotateX(-90deg) rotateY(0deg)',
    2:'rotateX(180deg) rotateY(0deg)',
    3:'rotateX(0deg) rotateY(-90deg)',
    4:'rotateX(0deg) rotateY(90deg)',
    5:'rotateX(0deg) rotateY(0deg)',
    6:'rotateX(90deg) rotateY(0deg)'
  };

  const die = document.getElementById('die');
  const rollBtn = document.getElementById('rollBtn');

  /* Hash params for Shortcuts data: URLs */
  const hash = location.hash.startsWith('#') ? location.hash.slice(1) : '';
  const q = new URLSearchParams(hash);
  const setVar = (k,v)=>document.documentElement.style.setProperty(k,v);

  const preset = (q.get('preset') || getComputedStyle(document.documentElement).getPropertyValue('--preset') || 'none').trim().toLowerCase();
  if (preset === 'ivory'){ setVar('--face','#f6edd6'); setVar('--edge','#c9c3b0'); setVar('--pip','#2a2a2a'); }

  [['--face','face'],['--pip','pip'],['--edge','edge'],['--bg','bg'],['--accent','accent'],
   ['--wear','wear'],['--pip-wear','pip-wear'],['--pip-size','pipSize'],['--roll-ms','rollMs'],
   ['--chips','chips'],['--chips-density','chipsDensity'],['--chips-contrast','chipsContrast'],['--chips-size','chipsSize']]
   .forEach(([cssKey,urlKey])=>{ const v=q.get(urlKey); if(v!==null) setVar(cssKey,v); });

  /* ---------- Texture generators ---------- */
  const R = n => Math.random()*n;

  function makeFaceTexture(){
    const S=256,c=document.createElement('canvas'); c.width=c.height=S; const ctx=c.getContext('2d');
    for(let i=0;i<14;i++){
      const r=30+R(70),x=R(S),y=R(S),g=ctx.createRadialGradient(x,y,0,x,y,r);
      const shade=Math.random()<0.5?0:255;
      g.addColorStop(0,`rgba(${shade},${shade},${shade},${0.05+R(0.08)})`); g.addColorStop(1,'rgba(0,0,0,0)');
      ctx.fillStyle=g; ctx.beginPath(); ctx.arc(x,y,r,0,6.283); ctx.fill();
    }
    for(let i=0;i<450;i++){
      const x=R(S),y=R(S),r=Math.random()<0.8?0.6:1.1;
      ctx.fillStyle=`rgba(0,0,0,${0.08+R(0.12)})`; ctx.beginPath(); ctx.arc(x,y,r,0,6.283); ctx.fill();
      if(Math.random()<0.35){ ctx.fillStyle=`rgba(255,255,255,${0.06+R(0.09)})`; ctx.beginPath(); ctx.arc(x+0.4,y+0.4,r*0.9,0,6.283); ctx.fill(); }
    }
    return c.toDataURL('image/png');
  }

  function makeEdgeChips(){
    const S=256,c=document.createElement('canvas'); c.width=c.height=S; const ctx=c.getContext('2d');
    const density=parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--chips-density'))||0.2;
    const sizeScale=parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--chips-size'))||1;
    const N=Math.round(100*density);
    for(let i=0;i<N;i++){
      const side=(Math.random()*4)|0; let x=R(S),y=R(S);
      const rr=(2+R(5))*sizeScale;
      if(side===0) y=2+R(8);
      if(side===1) y=S-2-R(8);
      if(side===2) x=2+R(8);
      if(side===3) x=S-2-R(8);
      ctx.fillStyle='rgba(0,0,0,0.18)'; ctx.beginPath(); ctx.arc(x,y,rr,0,6.283); ctx.fill();
      ctx.fillStyle='rgba(255,255,255,0.10)'; ctx.beginPath(); ctx.arc(x+0.6,y+0.6,rr*0.75,0,6.283); ctx.fill();
    }
    const v=ctx.createLinearGradient(0,0,0,S);
    v.addColorStop(0,'rgba(0,0,0,0.06)'); v.addColorStop(0.12,'rgba(0,0,0,0)');
    v.addColorStop(0.88,'rgba(0,0,0,0)'); v.addColorStop(1,'rgba(0,0,0,0.06)');
    ctx.fillStyle=v; ctx.fillRect(0,0,S,S);
    return c.toDataURL('image/png');
  }

  /* per-pip tiny texture */
  function makePipTexture(size=64){
    const S=size,c=document.createElement('canvas'); c.width=c.height=S; const ctx=c.getContext('2d');
    for(let i=0;i<200;i++){
      const x=Math.random()*S,y=Math.random()*S; const r=Math.random()<0.85?0.5:1.2;
      ctx.fillStyle=`rgba(255,255,255,${0.10+Math.random()*0.25})`;
      ctx.beginPath(); ctx.arc(x,y,r,0,6.283); ctx.fill();
    }
    for(let i=0;i<70;i++){
      const x=Math.random()*S,y=Math.random()*S,len=4+Math.random()*12,ang=Math.random()*Math.PI*2;
      ctx.strokeStyle='rgba(255,255,255,0.18)'; ctx.lineWidth=0.6;
      ctx.beginPath();
      ctx.moveTo(x-len/2*Math.cos(ang), y-len/2*Math.sin(ang));
      ctx.lineTo(x+len/2*Math.cos(ang), y+len/2*Math.sin(ang));
      ctx.stroke();
    }
    return c.toDataURL('image/png');
  }

  // Apply textures
  const faceTex = makeFaceTexture();
  document.querySelectorAll('.grit-face').forEach(el=>{ el.style.backgroundImage = `url('${faceTex}')`; });

  const chipsOn = (getComputedStyle(document.documentElement).getPropertyValue('--chips').trim() !== '0');
  if (chipsOn){
    const edgeTex = makeEdgeChips();
    document.querySelectorAll('.chips-edge').forEach(el=>{ el.style.backgroundImage = `url('${edgeTex}')`; });
  } else {
    document.querySelectorAll('.chips-edge').forEach(el=>{ el.style.opacity='0'; });
  }

  // UNIQUE texture per pip + random rotation + slight wear variance
  document.querySelectorAll('.dot').forEach(el=>{
    const tex = makePipTexture(64 + Math.floor(Math.random()*16)); // 64â€“80
    el.style.setProperty('--pipTex', `url('${tex}')`);
    el.style.setProperty('--pipRot', `${Math.floor(Math.random()*360)}deg`);
    const baseWear = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--pip-wear')) || 0.1;
    const jitter = (Math.random()*0.06) - 0.03; // -0.03..+0.03
    el.style.setProperty('--pipWearLocal', String(Math.max(0, baseWear + jitter)));
  });

  /* --- Roll logic: tumble on repeat --- */
  let last = 0;
  const qturns=(min=4,max=8)=>((Math.floor(Math.random()*(max-min+1))+min)*90);
  function setTumble(finalX,finalY){
    die.style.setProperty('--rx0','0deg'); die.style.setProperty('--ry0','0deg'); die.style.setProperty('--rz0','0deg');
    die.style.setProperty('--rx1',qturns()+'deg'); die.style.setProperty('--ry1',qturns()+'deg'); die.style.setProperty('--rz1',qturns(0,4)+'deg');
    die.style.setProperty('--rx2',qturns()+'deg'); die.style.setProperty('--ry2',qturns()+'deg'); die.style.setProperty('--rz2',qturns(0,4)+'deg');
    die.style.setProperty('--rx3',finalX); die.style.setProperty('--ry3',finalY); die.style.setProperty('--rz3','0deg');
  }
  const snap=v=>{ die.style.transform = ORIENT[v]; };
  function tumble(v){
    const [rx,ry] = ORIENT[v].match(/-?\d+deg/g);
    setTumble(rx,ry);
    die.classList.remove('rolling'); void die.offsetWidth;
    die.classList.add('rolling');
    setTimeout(()=>{ snap(v); die.classList.remove('rolling'); },
      parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--roll-ms')));
  }
  function roll(){
    const v = (Math.random()*6|0)+1;
    if(v===last){ tumble(v); } else { snap(v); }
    last = v;
  }

  rollBtn.addEventListener('click', roll, {passive:true});
  roll(); // first pose
</script>
</body>
</html>
